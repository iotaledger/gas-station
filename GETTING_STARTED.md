# IOTA Gas Station on Testnet

This guide is for setting up and using the IOTA Gas Station on the IOTA test network.

## Prerequisites

Before you start. Make sure you have installed:

- Docker: [Installation guide](https://docs.docker.com/engine/install/)
- Rust `1.83`: [Installation guide](https://www.rust-lang.org/tools/install)

>Note: Its recommended, but **NOT** necessary to have installed `iota` CLI binary. We use this CLI to fund the sponsor account. If you have already funded account you can skip this step.

If you have `iota` binary, please make sure you have configured test network:
Your configuration file `.iota/iota_config/client.yaml` should include a section for the testnet:

  ```yaml
  - alias: testnet
    rpc: "https://api.testnet.iota.cafe"
    ws: ~
    basic_auth: ~
  ```

Active network should be set to `testnet`:

  ```yaml
  active_env: testnet
  ```

## Setting Up the Gas Station

### Step 1: Redis Setup

The Gas Station requires Redis to sync state across multiple servers.
To set up Redis, run the following command:

```shell
make redis-run
```

### Step 2: Building the Gas Station

To build the gas station binary, run:

```bash
cargo build
```

This will generate two binaries:

- `./target/debug/tool`: gas station helper tool
- `./target/debug/iota-gas-station`: gas station server binary

### Step 3: Configuration

The gas station requires a configuration file named `config.yaml`
You can you use the `tool` to generate the config:

```bash
./target/debug/tool  generate-sample-config --config-path config.yaml
```

Below is an example configuration for the testnet:

```yaml
signer-config:
  local:
    keypair: AKT1Ghtd+yNbI9fFCQin3FpiGx8xoUdJMe7iAhoFUm4f
rpc-host-ip: 0.0.0.0
rpc-port: 9527
metrics-port: 9184
gas-pool-config:
  redis:
    redis_url: "redis://127.0.0.1"
fullnode-url: "https://api.testnet.iota.cafe"
coin-init-config:
  target-init-balance: 100000000
  refresh-interval-sec: 86400
daily-gas-usage-cap: 1500000000000
access-controller:
  access-policy: disabled
```

> **Note:** Replace the `keypair` value with your own keypair to be used as the sponsor

 If you decide to use the keypair autogenerated by the `tool`, please ensure the account has enough gas coins:

```bash
  iota client faucet --address [generated-account-address]
```

### Step 3: Start

Gas Station requires the `GAS_STATION_AUTH` to be set. This is an Bearer authentication token, that you will use to connect to the Gas Station HTTP endpoint.

```bash
GAS_STATION_AUTH="yours-bearer-token" ./target/debug/iota-gas-station --config-path config.yaml
```

### Expected Output

When the gas station starts, it will perform the initial coin-splitting procedure. You should see logs similar to the following:

```log
2024-12-16T17:12:49.369620Z  INFO iota_gas_station::gas_pool_initializer: Number of coins got so far: 392
2024-12-16T17:12:49.369690Z  INFO iota_gas_station::gas_pool_initializer: Splitting finished. Got 392 coins. New total balance: 39615604800. Spent 384395200 gas in total
2024-12-16T17:12:49.381289Z DEBUG iota_gas_station::storage::redis: After add_new_coins. New total balance: 39615604800, new coin count: 392
2024-12-16T17:12:49.381378Z DEBUG iota_gas_station::storage::redis: Releasing the init lock.
2024-12-16T17:12:49.382094Z  INFO iota_gas_station::gas_pool_initializer: New coin initialization took 0s
2024-12-16T17:12:49.383373Z  INFO iota_gas_station::rpc::server: listening on 0.0.0.0:9527
```

## Examples

Check the examples to learn how to create sponsored transactions:

- Rust [Sponsored Transaction](examples/rust/README.md)
- TypeScript [Sponsored Transaction](examples/ts/README.md)
